=======================================================
変更履歴
=======================================================

.. note::
  31.5.0 以前の変更履歴は :doc:`change_log_past` を参照してください

34.6.0 (未リリース)
******************************************

不具合修正
==========================================

* ビューポート右上のシフト押しながらでの矢印ボタンのドラッグで背景動画を動かせない

34.5.0 (2022/6/18)
******************************************

不具合修正
==========================================

* モデル選択時にマウスの中央ボタンでのカメラ移動が機能せず一方でカメラが動いてしまう
* モデル確認画面表示中に追加でモデルファイルをドロップできてしまう

  * モデル確認画面が表示中の場合は追加のモデルの読み込みを無視（＝ブロック）するように変更

* ``shared`` キーワードの持つエフェクトの読み込みに失敗すると落ちることがある

34.4.0 (2022/5/31)
******************************************

不具合修正
==========================================

* 細工された PMD モデルを読み込むと読み込みが終わらずハングする
* RGB24 形式の DDS が含まれたエフェクトが読み込めない

34.3.0 (2022/1/23)
******************************************

仕様変更
==========================================

* モデルプラグインをモデル編集においても利用可能になるようにした

不具合修正
==========================================

* エフェクトで利用する画像読み込み起因で不正な描画が発生することがある
* オフスクリーンを使ったエフェクトでリロードあるいはファイル書き換えで落ちる
* ポストエフェクトのコンパイルに失敗すると落ちることがある

34.2.0 (2021/11/3)
******************************************

不具合修正
==========================================

* Windows 版において「:ref:`D1BF8CFD-152D-4D1C-8B23-1FC6A4EBF391`」を有効にしてモデルを読み込むとメモリリークが発生する
* Windows 版においてレンダラが OpenGL の場合少し上に引き延ばされる形でレイアウトが崩れる
* オフスクリーン描画において描画不要のオブジェクトが描画されてしまう
* レンダラが OpenGL かつエフェクト利用時にレンダーターゲットがミップマップ使わないにもかかわらずミップマップフィルタが設定されてると描画エラーを起こす
* エフェクト設定画面の画像表示においてレンダラが OpenGL の場合垂直方向の反転表示になる

  * 加えて縦方向の引き延ばしにならないように調整

* 音源読み込み時に ``Cannot find PCM audio buffer`` で読み取れないエラー発生の抑制
* 32bit PCM 音源利用時波形表示がされない
* ``plugin_avfoundation`` で動画を書き出すとき非対応の周波数の音源があると落ちる

34.1.0 (2021/10/1)
******************************************

不具合修正
==========================================

* 34.0 で修正したモデル読み込み確認ダイアログ表示時の操作において読み込みがブロックされていなかったためそれを防ぐように追加
* モデル編集を有効にした状態で新規モデル作成を実施後にモデル編集画面へ移動しようとすると落ちる

  * 上記関連で「新規モデル作成」で生成されたモデルがプロジェクトに保存されない問題があったためこれも修正

* Windows 版において DirectX11 利用時かつアンチエイリアス有効後にウィンドウをリサイズすると水色の画面が表示される
* 以下の条件のいずれかに該当しかつミップマップを利用したポストエフェクトが使われている場合に落ちる

  * 動画出力時にビューポートサイズより小さいサイズで出力した場合
  * 「:ref:`88592664-60C0-40B8-B14A-06983999A95D`」を無効に切り替えた場合

* モデル編集において反射強度とエッジ幅が設定出来ない
* ステレオかつ 44100Hz の条件を満たさない音源利用時に ``plugin_ffmpeg`` でエンコードすると出力される音源にノイズが発生する
* Windows 版において言語設定を行うとメニューアイテムの状態が不正なものになる
* ビューポートのジャギーを減らすようにした
* 「:ref:`A843137E-D975-47B7-86F1-E018BF189873`」パネルの「補間」が「補完」になっている
* 動画出力において音源ありで開始を 0 より大きく設定して開始した場合場合音ズレが起きる

  * 出力の開始箇所にかかわらず音源の最初からはじまる不具合があった

* 動画出力において書き出しの終端がプロジェクトの終端フレームより大きく設定できてしまう問題
* プロジェクトの再生 FPS の設定により ``plugin_lsmash`` の出力見積りが実際より少なく表示されることがある

34.0.0 (2021/9/17)
******************************************

機能追加
==========================================

* 「:ref:`1CE450D5-1101-44CC-AA24-8DD1CAE204E1`」の追加

仕様変更
==========================================

* モデルモーション読み込み後にモデルに含まれるボーンまたはモーフに該当するキーフレームを全選択するようにした

  * MMD と挙動をあわせるための仕様変更となります

* キーフレーム登録時に登録されたキーフレームも同時に選択されるようにした

  * 上と同じ理由です
  * 処理の都合上クラッシュリカバリにはキーフレーム登録時の選択状態が保存されません

* nmm 及び pmm 形式においてキーフレーム選択状態を考慮する形で読み込み及び保存するようにした

  * nmm の場合は 33.4.0 未満から読み込んだ初回のみ従来どおり未選択状態になります
  * 33.4.0 以降で nmm を保存して読み込んだ場合はキーフレームの選択状態が復元されます

不具合修正
==========================================

* 33.0 以降で背景動画が読み込まれるもののビューポートに表示されない
* pmm 形式での保存時に保存処理でフリーズしてしまい強制終了以外に終了させることができなくなることがある
* モデル読み込み確認などで利用されるダイアログ表示中に各種操作が実行可能で条件次第ではそれ起因で落ちる

  * ダイアログ表示中に保存処理が行われた場合は進捗画面が表示されますが何もしません（本来行われてはいけないため）

* エフェクト利用時の画像のミップマップ生成数のミスにより落ちることがある
* ``plugin_lsmash`` を使って動画出力時にキャンセルすると強制終了以外に終了させることができなくなることがある

33.3.0 (2021/8/31)
******************************************

不具合修正
==========================================

* 音源を一回削除して別のファイルを読み込もうとすると最初に読み込まれた音源が再利用されることがある
* WAV 音源が正しく読み込まれない

33.2.0 (2021/7/19)
******************************************

不具合修正
==========================================

* カメラキーフレームを登録すると X の角度が反転する
* macOS において爆音が発生する現象を抑制する予防策を追加
* エフェクト読み込み時に例外処理すり抜けが原因でエラー表示が出来ずに落ちることがある

33.1.0 (2021/6/26)
******************************************

不具合修正
==========================================

* macOS 10.14 未満で利用すると落ちる
* ボーンをカーソルに当てたときのツールチップが表示されない
* 特定のアクセサリファイルを読み込むと落ちる

33.0.0 (2021/6/10)
******************************************

機能追加
==========================================

* モデル編集機能を大幅強化

  * 利用可能な機能については :doc:`model` を参照してください

* モデル上に表示されるハンドル操作時に選択中のボーンの接続情報を表示するようにした
* ビューポート右下に表示されるハンドル操作時に選択中のボーンの操作軸を表示するようにした
* 以下のメニューアイテムを追加（下２つはモデル編集用途のためデフォルトでは表示されない）

  * :ref:`D102480C-FFFB-43BA-9561-291E1AF4255B`
  * :ref:`5BB93875-36E2-42A2-B232-BD61D8FD131D`
  * :ref:`EEE59B7A-FB14-48E3-B63F-D39AF815CE51`
  * :ref:`07D2C58A-8399-48F6-A21E-C0D49D9C59FF`

* Grass Valley HQX Codec でエンコードされた動画を :ref:`4BF77CBD-F154-479A-8CC6-83F19677CB04` として利用できるようにした

  * 背景動画として使えるようにするのみで Grass Valley HQX Codec での動画書き出しはできません。また書き出し対応の予定もありません
  * ffmpeg による互換実装のデコーダのため動画によっては正しく読み込めない場合があります

* 「選択」において ``Alt + Shift`` を押しながらドラッグすると回転する機能を追加

  * 実験的な機能のため予告なく仕様変更または削除する可能性があります

仕様変更
==========================================

* モデル上に表示される移動または回転ハンドルを操作中選択されていない軸を半透明にする処理を追加
* 「右腕」または「左腕」を親に持つボーンに対してローカル軸を自動的に設定するようにした
* 選択されたボーンが移動または回転不可の場合ビューポート下のパラメータ入力のそれぞれの項目を無効にするようにした
* 高解像度ビューポートまたはアンチエイリアス有効時にビューポートに表示されるボーン接続やハンドルなどのアンチエイリアスを有効にするようにした

  * 変更前は表示負荷対策のため一律で無効にしていました

* 設定画面などの子ウィンドウの移動をタイトル部分のドラッグのみに制限するようにした

  * 変更前は子ウィンドウ内の任意の箇所にドラッグすると移動できる状態でした

* 非表示のモデルに対して物理演算を発生させないようにした

  * MMD の場合はモデルが非表示であっても物理演算の衝突判定が発生するのでご注意ください

* モーションファイルの読み込み時にカメラ及び照明のモーションかモデルモーションかをチェックするようにした

  * 従来は単純に無視していましたがそれゆえ間違って読み込んだ場合に認識できない問題があるためエラーを出すようにしました
  * 古い nanoem でカメラ及び照明モーションを書き出したファイルには対象名が設定されていないためエラーが出る可能性があります

* モデルモーションを読み込むときモデルが選択されていない場合はエラーを出すようにした
* モデルモーション読み込み時に対応するボーンあるいはモーフが見つからなかった場合は警告を出すようにした

不具合修正
==========================================

* モデル上に表示される移動または回転ハンドルを操作すると位置が飛ぶことがある
* ビューポート設定変更でマウスカーソルの位置ズレを起こすことがある
* Windows 版で DirectX 利用時に対応しない MSAA を指定すると落ちる
* Windows 版において DPI の異なるディスプレイに移動させたときスケールがおかしくなる
* プロジェクトが相対パスで保存されているにもかかわらず設定上では絶対パスが指定される
* カメラのズームインあるいはズームアウトするとモーフの変形状態がリセットされる
* 戻す方向にシークすると材質モーフがリセットされる
* カメラ原点から遠く離れた場所からリセットする時にモデルのエッジ表示が異常に太くなる
* エフェクト設定画面を開いてない状態でエフェクトファイルを割り当てると落ちる

  * エフェクト設定画面を開くように指示するエラーを出すように変更しました

* 非パースペクティブ時のカメラ計算が不正なことが原因で非パースペクティブを選ぶと何も描画されていないように見える
* ``shared`` キーワードを利用したエフェクトにおいてオフスクリーン内の描画対象が描画されないケースがある

  * 具体的には `msToonCoordinator <https://note.com/mashimashi_note/n/na1bc7c72e511>`_ で問題が顕在化

* モデル読み込み時にテクスチャが格納されているフォルダがモデルフォルダの外側にあると白く表示される
* プロジェクト保存時にモデルが未選択の場合読み込み時に未選択状態が反映されない
* Windows 版でエラー表示において文字化けが発生することがある
* ``Post_ScreenTex.fx`` を利用すると描画が正しく行われない
* カメラモーションを読み込んだときのアングルが間違っている（X 軸が反転している）

  * 32.0 以前で保存されたプロジェクトについては読み込み時に自動的に補正します
  * カメラモーションとして書き出してそれを読み込んだ場合は補正しないため元のプロジェクトから再度書き出してください

* プロジェクト読み込み失敗時及びエフェクトのメモリリークが発生していた問題
* 24bit 音源読み込み時に波形表示が行われない
* 背景動画に音源が含まれている場合正しくデコードされない場合がある
* エフェクト利用時に背景動画が正しく表示されない場合がある
* Windows 版において背景動画つきでプロジェクト保存した後それを読み込んだ場合背景動画が表示されない
* Windows 版において画像あるいは動画書き出しの時プロジェクト変更があったときの保存確認ダイアログが表示されない

32.0.0 (2021/3/8)
******************************************

機能追加
==========================================

* ソフトボディ実験的対応

仕様変更
==========================================

* nanoem アプリにおける Google Analytics (Google Measurement Protocol) の利用廃止

  * 詳細は :doc:`privacy` にて
  * Sentry によるクラッシュレポート機能は引き続き使われます

不具合修正
==========================================

* 画像あるいは動画出力時にポストエフェクトが含まれる状態でアンチエイリアスを有効にして実行すると落ちることがある
* アンチエイリアス設定後にエフェクトの RENDERCOLORTARGET セマンティックのテクスチャに対してアンチエイリアスが適用されない

  * 画像あるいは動画書き出しにおいてアンチエイリアスを有効にしてもポストエフェクトに対するアンチエイリアスが行われてなかった
  * オフスクリーンテクスチャはエフェクト側で制御する仕組みのため影響を受けない

* 画像あるいは動画出力画面時に出るダイアログを一回キャンセルし、もう一度行って破棄を押すとダイアログが二重に出てしまい落ちることがある
* macOS 版において Metal 利用時に「OS 付属のエンコーダを有効にする」にチェックを入れた状態で書き出すと真っ黒な動画が生成される
* Windows 版でメニューのアクセスキー（ニーモニック）が正しく機能しない
* Windows 版でファイル保存時に拡張子が二重になってしまうことがある

.. [#f1] GPU が利用できない場合 `WARP <https://docs.microsoft.com/en-us/windows/win32/direct3darticles/directx-warp>`_ を利用するように処理を追加したため原理的には発生しない
